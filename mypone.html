<!DOCTYPE html>
<html>
  <head> 
    <title></title>
    <link rel="stylesheet" type="text/css" href="mypone.css" />
    <!-- <script src="generate.js" type="text/javascript"></script> -->
    
  </head>
  <body >
    <div class="box1"><br>
    <input type="number" name="" id="number" /><br><br>
    <div id="myresult"></div>
    <select id="line">
      <option value="MTN">MTN</option>
      <option value="AIRTEL">AIRTEL</option>
      <option value="GLO">GLO</option>
      <option value="ETISALAT">ETISALAT</option>

    </select>
    <select id="amount">
      <option value="100">100</option>
      <option value="200">200</option>
      <option value="500">500</option>
      <option value="1000">1000</option>
    </select>
    <button onclick="buy()" class="add">BUYCARD</button>
    <button onclick="generate()" class="check">GENERATECARD</button>
  </div><br>
    <div class="box2">
      <p class="here">HERE ARE YOUR RECHARGE CARDS</p>
      <div class="border">
    <table style="width: 100%;">
      <tr>
        <th>S/N</th>
        <th>line</th>
        <th>amount</th>
        <th>number</th>
        <th>value</th>
      </tr>
      <tbody id="result"></tbody>
    </table>
    </div>
    </div>

    <div class="background">
      <div class="smart">
        <div class="content" id="screen">
        <!-- <button class="design" onclick="home()"></button> -->
        <!-- <button class="cal" onclick="display()"><img src="menu.png" /></button> -->
        <center>
          <!-- <div class="disp" id="dis"> -->
            <br />
             <select id="line1" class="sel">
      <option value="MTN">MTN</option>
       <option value="AIRTEL">AIRTEL</option>
      <option value="GLO">GLO</option>
      <option value="ETISALAT">ETISALAT</option>

    </select><br><br>
  <input type="text" name="" class="typ" id="screenb" />
  <input type="button" name="" value="1" onclick="a('1')" style="width: 50px; height:50px;border-radius: 10px;" />
  <input type="button" name="" value="2" onclick="a('2')" style="width: 50px; height: 50px; border-radius: 10px;"/>
  <input type="button" name="" value="3" onclick="a('3')" style="width: 50px; height: 50px; border-radius: 10px;"/><br />
  <input type="button" name="" value="4" onclick="a('4')" style="width: 50px; height: 50px; border-radius: 10px;"/>
  <input type="button" name="" value="5" onclick="a('5')" style="width: 50px; height: 50px; border-radius: 10px;"/>
  <input type="button" name="" value="6" onclick="a('6')" style="width: 50px; height: 50px; border-radius: 10px;"/><br />
<input type="button" name="" value="7" onclick="a('7')" style="width: 50px; height: 50px; border-radius: 10px;"/>
<input type="button" name="" value="8" onclick="a('8')" style="width: 50px; height: 50px; border-radius: 10px;"/>
<input type="button" name="" value="9" onclick="a('9')" style="width: 50px; height: 50px; border-radius: 10px;"/><br />
<input type="button" name="" value="*" onclick="a('*')" style="width: 50px; height: 50px; border-radius: 10px;" />
<input type="button" name="" value="0" onclick="a('0')" style="width: 50px; height: 50px; border-radius: 10px;" />
<input type="button" name="" value="#" onclick="a('#')" style="width: 50px; height: 50px; border-radius: 10px;"/><br />
<input type="button" name="" value="del" onclick="del('del')" style="width: 50px; height: 50px; border-radius: 10px;" />
<input type="button" name="" value="call" onclick="call('call')" style="width: 50px; height: 50px; border-radius: 10px;" />
 <input type="button" name="" value="end" onclick="check2()" style="width: 50px; height: 50px; border-radius: 10px;" />
          </div>
        </center>
               <button class="addd" onclick="myclick()"><img src="home.png"></button> 
       </div>

      </div>
    </div>
    <script type="text/javascript">
      

let generateISBN=()=>{
       let ISBN = Math.floor(1000000000000000+Math.random()*9000000000000000)
        return ISBN
        }
let buy=()=>{
        let repeat =parseInt(number.value)
   for (var i = 0; i < repeat; i++) {
      
     var obj ={
    amounts: amount.value,
    network:line.value,
    number:generateISBN(),
    value:"unused",
  }
if (!localStorage.hasOwnProperty("mylibrary")) {
       localStorage.setItem("mylibrary",JSON.stringify([]))
   }
  
else{
  let array = JSON.parse(localStorage.getItem("mylibrary"))
    array.push(obj)
    localStorage.setItem("mylibrary",JSON.stringify(array))
}
}
};

let generatecard;


let generate=()=>{
    let row;
  let table = "<table border='2px'solid black><tr>"
  "<tr><td>s/N</td><td>network</td><td>amount</td>"
  generatecard = JSON.parse(localStorage.getItem("mylibrary"))
  
  for (var i = 0; i < generatecard.length; i++) {
    let o = i+1
    let s = generatecard[i].box;
    let p = generatecard[i].network;
    let q = generatecard[i].amounts;
    let r = generatecard [i].number;
    let j = generatecard[i].value;
    
    row = `<tr><td>${o}</td><td>${p}</td><td>${q}</td><td>${r}</td><td>${j}</td></tr>`
    table+=row
  }
  table+="</table>"
  result.innerHTML = table
}

let a = (num) => {
  screenb.value += num;
};
let del = () => {
  screenb.value = screenb.value.slice(0, -1);
};


let balanceValue

let check=()=>{
  let getbalance = JSON.parse(localStorage.getItem("balance"))
  if (screenb.value == "") {
    screenb.value ="input a code"
  }
  else if (screenb.value=="*556#" && line1.value== "MTN") {
   balanceValue = getbalance.find((val,index)=>index==0)
   
     screenb.value="balance : "+"#"+ balanceValue.amount
  }
  else if (screenb.value=="*123#" && line1.value== "AIRTEL") {
    balanceValue = getbalance.find((val,index)=>index==1)
   
     screenb.value="balance : "+"#"+ balanceValue.amount
  }

   else if (screenb.value=="#124*1#" && line1.value== "GLO") {
    balanceValue = getbalance.find((val,index)=>index==2)
   
     screenb.value="balance : "+ "#"+balanceValue.amount
  }
  else if (screenb.value=="*222#" && line1.value== "ETISALAT") {
    
    balanceValue = getbalance.find((val,index)=>index==3)
   
     screenb.value="balance : "+"#"+ balanceValue.amount
   }
      }
  

 
  

var min = 0
var second = 0
var zeroplaceholder = 0
function countUp(){
  second++
  if (second<10) {
    screenb.value= `0${min}:0${second}`
  }
  else {
    if (second%60==0) {
      min++
      second="0"+1
    }
    screenb.value=`0${min}:${second}`
  }

 
}
// console.log(setInterval(function(){countUp()},1000)   )
// console.log(second);
// console.log(min);


   let timmm

function call() {
  let array1;
let beb;
let collect = JSON.parse(localStorage.mylibrary)
for (var i = 0; i < collect.length; i++) {
 beb=screenb.value
  if(beb.includes(collect[i].number) && line1.value == collect[i].network && collect[i].value=="unused"){
screenb.value=collect[i].network+" "+collect[i].amounts+" "+"loaded"

collect[i].value="used"

//let objOfBalance={network:line1.value, amount:collect[i].amounts}

if (!localStorage.hasOwnProperty("balance")) {
       
       array1= [{network:"MTN", amount:0},{network:"AIRTEL", amount:0}, {network:"GLO", amount:0}, {network:"ETISALAT", amount:0}];

   }
  
else{
   array1 = JSON.parse(localStorage.getItem("balance"))
    
    
}
// array1.push(objOfBalance)
for (var j = 0; j < array1.length; j++) {
  
  
  if (array1[j].network== collect[i].network ) {

   array1[j].amount=Number(array1[j].amount) + Number(collect[i].amounts); 
  }
  
}
localStorage.setItem("balance",JSON.stringify(array1))
  }
  else if(beb.length==11 && beb[0]==0){
    screenb.value="loading..."

  timmm = setInterval(function(){countUp()},1000)
     setTimeout(timmm,10000)

  }
  
  else {
    check()
  }
  
}
localStorage.setItem("mylibrary",JSON.stringify(collect))
}
let check2=()=>{
    let screendata = screenb.value

  if (screendata[2]==":" && screendata.length==5) {
    let balanceData = JSON.parse(localStorage.balance)
    let findNetwork = balanceData.find(val=>val.network==line1.value)
    let data1=screendata.slice(1,2)
    let data2=screendata.slice(3,5)
    let totalTime = (Number(data1)*60)+Number(data2)
    let finalResult =totalTime*0.24
   findNetwork.amount-=finalResult
   screenb.value=` cost : ${finalResult}`
   localStorage.balance=JSON.stringify(balanceData)
   clearInterval(timmm)

 }
 else{
  screenb.value=""
 }
}


    var totalTime;
    let name=()=>{
    var date = new Date()
   totalTime= date.toLocaleTimeString();
  screenb.innerHTML= totalTime;
}
setInterval( name,1000);





   </script>
  </body>
</html>
